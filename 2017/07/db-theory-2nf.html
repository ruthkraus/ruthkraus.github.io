<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Процедура нормализации данных и нормальные формы данных (2НФ). - kamyanskiy.github.io</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://kamyanskiy.github.io/images/logo.png" rel="icon">

<link rel="canonical" href="https://kamyanskiy.github.io/2017/07/db-theory-2nf.html">

        <meta name="author" content="Alexander Kamyanskiy" />
        <meta name="keywords" content="SQL,theory,DB,database,1NF,2NF" />
        <meta name="description" content="Итак пришло время привести данные, которые мы привели к 1НФ, ко 2НФ. Само понятие 2НФ можно процитировать из книги Дж. Дейта, как: 2НФ - переменная отношения находится во 2нф тогда и только тогда, когда она находится в первой нф и каждый неключевой атрибут неприводимо зависит от ее первичного ключа.(предполагается наличие …" />

        <meta property="og:site_name" content="kamyanskiy.github.io" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Процедура нормализации данных и нормальные формы данных (2НФ)."/>
        <meta property="og:url" content="https://kamyanskiy.github.io/2017/07/db-theory-2nf.html"/>
        <meta property="og:description" content="Итак пришло время привести данные, которые мы привели к 1НФ, ко 2НФ. Само понятие 2НФ можно процитировать из книги Дж. Дейта, как: 2НФ - переменная отношения находится во 2нф тогда и только тогда, когда она находится в первой нф и каждый неключевой атрибут неприводимо зависит от ее первичного ключа.(предполагается наличие …"/>
        <meta property="article:published_time" content="2017-07-04" />
            <meta property="article:section" content="Blog" />
            <meta property="article:tag" content="SQL" />
            <meta property="article:tag" content="theory" />
            <meta property="article:tag" content="DB" />
            <meta property="article:tag" content="database" />
            <meta property="article:tag" content="1NF" />
            <meta property="article:tag" content="2NF" />
            <meta property="article:author" content="Alexander Kamyanskiy" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://kamyanskiy.github.io/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="https://kamyanskiy.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://kamyanskiy.github.io/theme/css/pygments/emacs.css" rel="stylesheet">
    <link href="https://kamyanskiy.github.io/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
        <link href="https://kamyanskiy.github.io/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="https://kamyanskiy.github.io/theme/css/style.css" type="text/css"/>
        <link href="https://kamyanskiy.github.io/theme/css/custom.css" rel="stylesheet">





</head>
<body>
<a href="https://github.com/kamyanskiy"><img class="fork-me-on-github" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://kamyanskiy.github.io/" class="navbar-brand">
<img class="img-responsive pull-left gap-right" src="https://kamyanskiy.github.io/images/logo.png" width=""/> kamyanskiy.github.io            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://kamyanskiy.github.io/about-me.html">
                             About&nbsp;me
                          </a></li>
                        <li class="active">
                            <a href="https://kamyanskiy.github.io/category/blog/">Blog</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="https://kamyanskiy.github.io/archives/"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="https://kamyanskiy.github.io" title="kamyanskiy.github.io"><i class="fa fa-home fa-lg"></i></a></li>
                <li class="active">Процедура нормализации данных и нормальные формы данных&nbsp;(2НФ).</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://kamyanskiy.github.io/2017/07/db-theory-2nf.html"
                       rel="bookmark"
                       title="Permalink to Процедура нормализации данных и нормальные формы данных (2НФ).">
                        Процедура нормализации данных и нормальные формы данных&nbsp;(2НФ).
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2017-07-04T00:00:00+03:00"> Tue 04 July 2017</time>
    </span>


            <span class="label label-default">By</span>
            <a href="https://kamyanskiy.github.io/author/alexander-kamyanskiy.html"><i class="fa fa-user"></i> Alexander Kamyanskiy</a>



<span class="label label-default">Tags</span>
	<a href="https://kamyanskiy.github.io/label/sql/">SQL</a>
        /
	<a href="https://kamyanskiy.github.io/label/theory/">theory</a>
        /
	<a href="https://kamyanskiy.github.io/label/db/">DB</a>
        /
	<a href="https://kamyanskiy.github.io/label/database/">database</a>
        /
	<a href="https://kamyanskiy.github.io/label/1nf/">1NF</a>
        /
	<a href="https://kamyanskiy.github.io/label/2nf/">2NF</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Итак пришло время привести данные, которые мы привели к 1НФ, ко 2НФ.
Само понятие 2НФ можно процитировать из книги Дж. Дейта,&nbsp;как:</p>
<blockquote>
<p><strong>2НФ</strong> - переменная отношения находится во 2нф тогда и только тогда, когда она 
находится в первой нф и каждый неключевой атрибут неприводимо зависит от 
ее первичного ключа.(предполагается наличие 1 потенциального ключа который 
является первичным&nbsp;ключом) </p>
</blockquote>
<h5>Первый этап нормализации (подразумевается что отношения уже в&nbsp;1НФ)</h5>
<blockquote>
<p>Всякую переменную отношения которая находится в 1НФ, но не находится во 2НФ 
всегда можно свести к эквивалентному множеству отношений находящихся во&nbsp;2НФ.</p>
</blockquote>
<p>Этот процесс заключается в замене переменной отношения 1НФ подходящим набором
проекций, эквивалентных исходной переменной отношения , в том смысле что ее 
всегда можно будет восстановить путем соединения данных&nbsp;проекций.</p>
<blockquote>
<p>Если есть R {A,B,C,D} <span class="caps">PRIMARY</span> <span class="caps">KEY</span> {A,B} (предположим что А зависит от D A -&gt;&nbsp;D),</p>
<p>тогда процедура нормализации состоит в замене этой R двумя проекциями
R1 {A, D} <span class="caps">PRIMARY</span> <span class="caps">KEY</span> {A}
R2 {A, B, C} <span class="caps">PRIMARY</span> <span class="caps">KEY</span> {A,B} <span class="caps">FOREIGN</span> <span class="caps">KEY</span> {A} <span class="caps">REFERENCES</span>&nbsp;R1</p>
</blockquote>
<p>получается R2 будет иметь атрибут А как внешний ключ ссылаясь на первичный ключ 
A таблицы R1 и переменная отношения R может быть восстановлена посредством 
соединения переменных отношения R1 R2 по внешнему ключу и соответствующему ему 
первичному ключу этих переменных&nbsp;отношения.</p>
<p>Своими словами, если у нас в таблице есть столбец который явно зависит от 
первичного ключа, его следует выделить в отдельную таблицу, где будет 
первичный ключ и этот столбец, а в исходной таблице бывший первичный ключ 
станет&nbsp;внешним.</p>
<p>(фактически это приводит к удалению дубликатов в строках и 
разделению данных которые зависят от одной из частей составного первичного ключа,
фактически разделяется на отдельные отношения в которых отдельная часть 
составного первичного ключа будет являться первичным ключом а, второе отношение 
будет иметь составной первичный ключ, в котором выделенная часть 
предыдущего составного первичного ключа будет внешним ключом по отношению к 
первичному ключу отделенного&nbsp;отношения)</p>
<p>Напомним к чему мы пришли приведя данные в&nbsp;1НФ:</p>
<div class="highlight"><pre><span></span>haircolors=# ALTER TABLE customers DROP COLUMN address_old ;
ALTER TABLE
haircolors=# select * from customers ;
 id | firstname | lastname | phonenumber  | manufacturer |     product_name      |      dateorder      |   price    | qty | salon_name | address 
----+-----------+----------+--------------+--------------+-----------------------+---------------------+------------+-----+------------+---------
  5 | Денис     | Петров   | +79784567897 | Matrix       | Краска для волос      | 2017-07-03 12:15:01 | 899.01 руб |   3 |          1 |       1
  6 | Денис     | Петров   | +79784567897 | Matrix       | Краска для волос      | 2017-07-03 12:15:01 | 899.01 руб |   3 |          2 |       1
  7 | Денис     | Петров   | +79784567897 | Matrix       | Краска для волос      | 2017-07-03 12:15:01 | 899.01 руб |   3 |          4 |       1
  8 | Денис     | Петров   | +79784567897 | Loreal       | Краска для волос      | 2017-07-03 12:16:01 | 599.12 руб |   2 |          1 |       1
  9 | Денис     | Петров   | +79784567897 | Loreal       | Краска для волос      | 2017-07-03 12:16:01 | 599.12 руб |   2 |          2 |       1
 10 | Денис     | Петров   | +79784567897 | Loreal       | Краска для волос      | 2017-07-03 12:16:01 | 599.12 руб |   2 |          4 |       1
 11 | Юлия      | Бабкина  | +79784168585 | Blond        | Краска для волос      | 2017-07-02 11:01:01 | 299.12 руб |  12 |          3 |       2
 12 | Юлия      | Бабкина  | +79784168585 | Blond        | Краска для волос      | 2017-07-02 11:01:01 | 299.12 руб |  12 |          4 |       2
 13 | Юлия      | Бабкина  | +79784168585 | Blond        | Краска для волос      | 2017-07-02 11:01:01 | 299.12 руб |  12 |          5 |       2
 14 | Юлия      | Бабкина  | +79784168585 | Союз         | Полотенца одноразовые | 2017-07-02 11:01:01 | 199.12 руб | 120 |          3 |       2
 15 | Юлия      | Бабкина  | +79784168585 | Союз         | Полотенца одноразовые | 2017-07-02 11:01:01 | 199.12 руб | 120 |          4 |       2
 16 | Юлия      | Бабкина  | +79784168585 | Союз         | Полотенца одноразовые | 2017-07-02 11:01:01 | 199.12 руб | 120 |          5 |       2
(12 rows)

haircolors=# select * from salon;
 salon_id | salon_name 
----------+------------
        1 | Е-Студия
        2 | Ле-туаль
        3 | UpDo
        4 | ViVa
        5 | Diana
(5 rows)

haircolors=# select * from address ;
 id |    city     | building | flat_no |         street          | zip_code 
----+-------------+----------+---------+-------------------------+----------
  1 | Севастополь |       77 |      54 | ул. Александра Косарева |   299006
  2 | Севастополь |        1 |      55 | ул. Кесаева             |   299003
(2 rows)
</pre></div>


<p>Явно видно, что имя-фамилия покупателей образуют уникальный ключ и существует связь
с полем <strong>address</strong>, создадим таблицу <span class="caps">PERSON</span> в ней создадим поле <strong>address</strong>,
которое является внешним ключом ссылающимся на первичный ключ таблицы <span class="caps">ADDRESS</span> (id)
и свяжет таким образом покупателя с адресом (person.address(<span class="caps">FK</span>)) -&gt; address.id(<span class="caps">PK</span>).
Заполним таблицу&nbsp;данными:  </p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">PERSON</span> <span class="p">(</span>
  <span class="n">PERSON_ID</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">FIRSTNAME</span>      <span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">LASTNAME</span>       <span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">PHONENUMBER</span>    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">ADDRESS</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">fk_address_id</span>
     <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ADDRESS</span><span class="p">)</span> 
     <span class="k">REFERENCES</span> <span class="n">address</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PERSON</span> <span class="p">(</span><span class="n">PERSON_ID</span><span class="p">,</span> <span class="n">FIRSTNAME</span><span class="p">,</span> <span class="n">LASTNAME</span><span class="p">,</span> <span class="n">PHONENUMBER</span><span class="p">,</span> <span class="n">ADDRESS</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span>
<span class="mf">1</span><span class="p">,</span> <span class="s1">&#39;Денис&#39;</span><span class="p">,</span> <span class="s1">&#39;Петров&#39;</span><span class="p">,</span> <span class="s1">&#39;+79784567897&#39;</span><span class="p">,</span> <span class="mf">1</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PERSON</span> <span class="p">(</span><span class="n">PERSON_ID</span><span class="p">,</span> <span class="n">FIRSTNAME</span><span class="p">,</span> <span class="n">LASTNAME</span><span class="p">,</span> <span class="n">PHONENUMBER</span><span class="p">,</span> <span class="n">ADDRESS</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span>
<span class="mf">2</span><span class="p">,</span> <span class="s1">&#39;Юлия&#39;</span><span class="p">,</span> <span class="s1">&#39;Бабкина&#39;</span><span class="p">,</span> <span class="s1">&#39;+79784168585&#39;</span><span class="p">,</span> <span class="mf">2</span><span class="p">);</span>
</pre></div>


<p>не забудем, для целостности данных добавим уникальность полю <strong>address</strong>
ведь у нас 1 покупатель может иметь только 1 уникальный адрес, мы условились что
разные покупатели не могут иметь один и тот же&nbsp;адрес:</p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="k">ADD</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">address</span><span class="p">);</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# \d person
              Table &quot;public.person&quot;
   Column    |          Type          | Modifiers 
-------------+------------------------+-----------
 person_id   | integer                | not null
 firstname   | character varying(128) | not null
 lastname    | character varying(128) | not null
 phonenumber | character varying(20)  | not null
 address     | integer                | 
Indexes:
    &quot;person_pkey&quot; PRIMARY KEY, btree (person_id)
    &quot;person_address_key&quot; UNIQUE CONSTRAINT, btree (address)
Foreign-key constraints:
    &quot;fk_address_id&quot; FOREIGN KEY (address) REFERENCES address(id)
Referenced by:
    TABLE &quot;customers&quot; CONSTRAINT &quot;fk_person_id&quot; FOREIGN KEY (person_id) REFERENCES person(person_id)
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# select * from person ;
 person_id | firstname | lastname | phonenumber  | address 
-----------+-----------+----------+--------------+---------
         1 | Денис     | Петров   | +79784567897 |       1
         2 | Юлия      | Бабкина  | +79784168585 |       2
(2 rows)
</pre></div>


<p>Теперь при попытке назначить один и тот же адрес 2м разным пользователям система
откажет в операции и вызовет исключение, попробуем установить Юлии Бабкиной такой 
же адрес как Денису&nbsp;Петрову:</p>
<div class="highlight"><pre><span></span>haircolors=# UPDATE person SET address=1 WHERE person_id=2;
ERROR:  duplicate key value violates unique constraint &quot;person_address_key&quot;
DETAIL:  Key (address)=(1) already exists.
</pre></div>


<p>Единственое, ошибочка вышла, лучше переименум поле <strong>address</strong> в <strong>address_id</strong>
чтоб отражался&nbsp;смысл</p>
<div class="highlight"><pre><span></span> <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="k">RENAME</span> <span class="k">COLUMN</span> <span class="n">address</span> <span class="k">TO</span> <span class="n">address_id</span><span class="p">;</span>
</pre></div>


<p>Таблица примет&nbsp;вид</p>
<div class="highlight"><pre><span></span>haircolors=# \d person
              Table &quot;public.person&quot;
   Column    |          Type          | Modifiers 
-------------+------------------------+-----------
 person_id   | integer                | not null
 firstname   | character varying(128) | not null
 lastname    | character varying(128) | not null
 phonenumber | character varying(20)  | not null
 address_id  | integer                | 
Indexes:
    &quot;person_pkey&quot; PRIMARY KEY, btree (person_id)
    &quot;person_address_key&quot; UNIQUE CONSTRAINT, btree (address_id)
Foreign-key constraints:
    &quot;fk_address_id&quot; FOREIGN KEY (address_id) REFERENCES address(id)
Referenced by:
    TABLE &quot;partner&quot; CONSTRAINT &quot;partner_person_id_fkey&quot; FOREIGN KEY (person_id) REFERENCES person(person_id)
</pre></div>


<p>c&nbsp;данными:</p>
<div class="highlight"><pre><span></span>haircolors=# select * from person ;
 person_id | firstname | lastname | phonenumber  | address_id 
-----------+-----------+----------+--------------+------------
         1 | Денис     | Петров   | +79784567897 |          1
         2 | Юлия      | Бабкина  | +79784168585 |          2
(2 rows)
</pre></div>


<p>Таким образом мы выразили связь ОДИН К ОДНОМУ (<span class="caps">ONE</span> <span class="caps">TO</span> <span class="caps">ONE</span>), используя внешний
ключ и уникальный индекс.
Можно было также в модели <span class="caps">ADDRESS</span> добавить поле person_id, сделать его внешним 
ключом и добавить уникальность. (т.е. фактически то же самое, но в обратную сторону)
Пока будем считать что мы сделали равнозначный вариант, но предполагаю что в 
будущем не исключено что можно сделать обратное, например для некоего&nbsp;удобства.</p>
<p>Теперь нашу исходную таблицу <span class="caps">CUSTOMERS</span> можно представить так, мы добавим столбец 
person_id и по нему все также мы можем узнать адрес покупателя, т.е. информацию 
мы не теряем, это самый главный принцип, мы не должны в результате нормализации
потерять часть информации. Т.е. можем убрать столбцы firstname, lastname, 
phonenumber, address и все равно можем узнать имя-фамилию, телефон, адрес&nbsp;покупателя.</p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">CUSTOMERS</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">firstname</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">CUSTOMERS</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">lastname</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">CUSTOMERS</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">phonenumber</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">CUSTOMERS</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">address</span><span class="p">;</span>


<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">customers</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">person_id</span> <span class="nb">INT</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">customers</span> 
   <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">fk_person_id</span>
   <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">person_id</span><span class="p">)</span> 
   <span class="k">REFERENCES</span> <span class="n">person</span><span class="p">(</span><span class="n">person_id</span><span class="p">);</span>

<span class="k">UPDATE</span> <span class="n">customers</span> <span class="k">SET</span> <span class="n">person_id</span> <span class="o">=</span> <span class="mf">1</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">,</span><span class="mf">7</span><span class="p">,</span><span class="mf">8</span><span class="p">,</span><span class="mf">9</span><span class="p">,</span><span class="mf">10</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">customers</span> <span class="k">SET</span> <span class="n">person_id</span> <span class="o">=</span> <span class="mf">2</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">,</span><span class="mf">7</span><span class="p">,</span><span class="mf">8</span><span class="p">,</span><span class="mf">9</span><span class="p">,</span><span class="mf">10</span><span class="p">);</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# select * from customers ;
 id | manufacturer |     product_name      |      dateorder      |   price    | qty | salon_name | person_id 
----+--------------+-----------------------+---------------------+------------+-----+------------+-----------
  5 | Matrix       | Краска для волос      | 2017-07-03 12:15:01 | 899.01 руб |   3 |          1 |         1
  6 | Matrix       | Краска для волос      | 2017-07-03 12:15:01 | 899.01 руб |   3 |          2 |         1
  7 | Matrix       | Краска для волос      | 2017-07-03 12:15:01 | 899.01 руб |   3 |          4 |         1
  8 | Loreal       | Краска для волос      | 2017-07-03 12:16:01 | 599.12 руб |   2 |          1 |         1
  9 | Loreal       | Краска для волос      | 2017-07-03 12:16:01 | 599.12 руб |   2 |          2 |         1
 10 | Loreal       | Краска для волос      | 2017-07-03 12:16:01 | 599.12 руб |   2 |          4 |         1
 11 | Blond        | Краска для волос      | 2017-07-02 11:01:01 | 299.12 руб |  12 |          3 |         2
 12 | Blond        | Краска для волос      | 2017-07-02 11:01:01 | 299.12 руб |  12 |          4 |         2
 13 | Blond        | Краска для волос      | 2017-07-02 11:01:01 | 299.12 руб |  12 |          5 |         2
 14 | Союз         | Полотенца одноразовые | 2017-07-02 11:01:01 | 199.12 руб | 120 |          3 |         2
 15 | Союз         | Полотенца одноразовые | 2017-07-02 11:01:01 | 199.12 руб | 120 |          4 |         2
 16 | Союз         | Полотенца одноразовые | 2017-07-02 11:01:01 | 199.12 руб | 120 |          5 |         2
(12 rows)
</pre></div>


<p>Теперь наша таблица <span class="caps">CUSTOMERS</span> все больше напоминает список заказов которые делает
покупатель, который представлен внешним ключом&nbsp;person_id. </p>
<p>Продолжим, явно у нас есть связь между производителем и продуктом, т.е. продукт явно
должен быть кем то произведен, причем продукт может производиться разными&nbsp;производителями.</p>
<p>Правило приведения ко 2НФ советует сделать таблицы для столбцов с повторяющимися&nbsp;значениями.</p>
<p>Так и поступим, создадим таблицу <span class="caps">MANUFACTURER</span>:</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">MANUFACTURER</span> <span class="p">(</span>
  <span class="n">MANUFACTURER_ID</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="k">NAME</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">256</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">MANUFACTURER</span> <span class="p">(</span><span class="n">MANUFACTURER_ID</span><span class="p">,</span> <span class="k">NAME</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="s1">&#39;Matrix&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">MANUFACTURER</span> <span class="p">(</span><span class="n">MANUFACTURER_ID</span><span class="p">,</span> <span class="k">NAME</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">2</span><span class="p">,</span> <span class="s1">&#39;Loreal&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">MANUFACTURER</span> <span class="p">(</span><span class="n">MANUFACTURER_ID</span><span class="p">,</span> <span class="k">NAME</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">3</span><span class="p">,</span> <span class="s1">&#39;Blond&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">MANUFACTURER</span> <span class="p">(</span><span class="n">MANUFACTURER_ID</span><span class="p">,</span> <span class="k">NAME</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">4</span><span class="p">,</span> <span class="s1">&#39;Союз&#39;</span><span class="p">);</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# \d manufacturer
             Table &quot;public.manufacturer&quot;
     Column      |          Type          | Modifiers 
-----------------+------------------------+-----------
 manufacturer_id | integer                | not null
 name            | character varying(256) | not null
Indexes:
    &quot;manufacturer_pkey&quot; PRIMARY KEY, btree (manufacturer_id)

haircolors=# select * from manufacturer ;
 manufacturer_id |  name  
-----------------+--------
               1 | Matrix
               2 | Loreal
               3 | Blond
               4 | Союз
(4 rows)
</pre></div>


<p>А теперь создадим таблицу <span class="caps">PRODUCT</span>, здесь явно видна связь между названием продукта/товара,
производителем и ценой.
Фактически атрибуты <span class="caps">NAME</span> и MANUFACTURER_ID образуют первичный ключ, но я добавлю
отдельный первичный ключ для удобства - PRODUCT_ID. Это некоторая избыточность с теоретической 
точки зрения, но мне кажется что с таким подходом работать с данными удобнее.
Теоретически я не должен добавлять PRODUCT_ID, уникальность уже обеспечивает 
связка название товара - производитель, но в таком случае у нас будет сложный 
первичный ключ (первичный ключ образованный значениями 2х&nbsp;столбцов).</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">PRODUCT</span> <span class="p">(</span>
  <span class="n">PRODUCT_ID</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="k">NAME</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mf">256</span><span class="p">),</span>
  <span class="n">MANUFACTURER_ID</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">manufacturer</span><span class="p">(</span><span class="n">manufacturer_id</span><span class="p">),</span>
  <span class="n">PRICE</span> <span class="nb">MONEY</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCT</span> <span class="p">(</span><span class="n">PRODUCT_ID</span><span class="p">,</span> <span class="k">NAME</span><span class="p">,</span> <span class="n">MANUFACTURER_ID</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span>
<span class="mf">1</span><span class="p">,</span> <span class="s1">&#39;Краска для волос&#39;</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">899.01</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCT</span> <span class="p">(</span><span class="n">PRODUCT_ID</span><span class="p">,</span> <span class="k">NAME</span><span class="p">,</span> <span class="n">MANUFACTURER_ID</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span>
<span class="mf">2</span><span class="p">,</span> <span class="s1">&#39;Краска для волос&#39;</span><span class="p">,</span> <span class="mf">2</span><span class="p">,</span> <span class="mf">599.12</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCT</span> <span class="p">(</span><span class="n">PRODUCT_ID</span><span class="p">,</span> <span class="k">NAME</span><span class="p">,</span> <span class="n">MANUFACTURER_ID</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span>
<span class="mf">3</span><span class="p">,</span> <span class="s1">&#39;Краска для волос&#39;</span><span class="p">,</span> <span class="mf">3</span><span class="p">,</span> <span class="mf">299.12</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCT</span> <span class="p">(</span><span class="n">PRODUCT_ID</span><span class="p">,</span> <span class="k">NAME</span><span class="p">,</span> <span class="n">MANUFACTURER_ID</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span>
<span class="mf">4</span><span class="p">,</span> <span class="s1">&#39;Полотенца одноразовые&#39;</span><span class="p">,</span> <span class="mf">4</span><span class="p">,</span> <span class="mf">199.12</span><span class="p">);</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# \d product
                Table &quot;public.product&quot;
     Column      |          Type          | Modifiers 
-----------------+------------------------+-----------
 product_id      | integer                | not null
 name            | character varying(256) | 
 manufacturer_id | integer                | 
 price           | money                  | 
Indexes:
    &quot;product_pkey&quot; PRIMARY KEY, btree (product_id)
Foreign-key constraints:
    &quot;product_manufacturer_id_fkey&quot; FOREIGN KEY (manufacturer_id) REFERENCES manufacturer(manufacturer_id)

haircolors=# select * from product ;
 product_id |         name          | manufacturer_id |   price    
------------+-----------------------+-----------------+------------
          1 | Краска для волос      |               1 | 899.01 руб
          2 | Краска для волос      |               2 | 599.12 руб
          3 | Краска для волос      |               3 | 299.12 руб
          4 | Полотенца одноразовые |               4 | 199.12 руб
(4 rows)
</pre></div>


<p>Теперь мы можем сослаться на product_id таблицы <span class="caps">PRODUCT</span> в нашей изначальной 
таблице чтобы обозначить что покупают покупатели.
Добавим столбец product_id в таблицу <span class="caps">CUSTOMERS</span>, как внешний ключ ссылающийся на
значение поля таблицы <span class="caps">PRODUCT</span>.PRODUCT_ID</p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">customers</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">product_id</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">product</span><span class="p">(</span><span class="n">product_id</span><span class="p">);</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# select * from customers ;
 id | manufacturer |     product_name      |      dateorder      |   price    | qty | salon_name | person_id | product_id 
----+--------------+-----------------------+---------------------+------------+-----+------------+-----------+------------
  5 | Matrix       | Краска для волос      | 2017-07-03 12:15:01 | 899.01 руб |   3 |          1 |         1 |           
  6 | Matrix       | Краска для волос      | 2017-07-03 12:15:01 | 899.01 руб |   3 |          2 |         1 |           
  7 | Matrix       | Краска для волос      | 2017-07-03 12:15:01 | 899.01 руб |   3 |          4 |         1 |           
  8 | Loreal       | Краска для волос      | 2017-07-03 12:16:01 | 599.12 руб |   2 |          1 |         1 |           
  9 | Loreal       | Краска для волос      | 2017-07-03 12:16:01 | 599.12 руб |   2 |          2 |         1 |           
 10 | Loreal       | Краска для волос      | 2017-07-03 12:16:01 | 599.12 руб |   2 |          4 |         1 |           
 11 | Blond        | Краска для волос      | 2017-07-02 11:01:01 | 299.12 руб |  12 |          3 |         2 |           
 12 | Blond        | Краска для волос      | 2017-07-02 11:01:01 | 299.12 руб |  12 |          4 |         2 |           
 13 | Blond        | Краска для волос      | 2017-07-02 11:01:01 | 299.12 руб |  12 |          5 |         2 |           
 14 | Союз         | Полотенца одноразовые | 2017-07-02 11:01:01 | 199.12 руб | 120 |          3 |         2 |           
 15 | Союз         | Полотенца одноразовые | 2017-07-02 11:01:01 | 199.12 руб | 120 |          4 |         2 |           
 16 | Союз         | Полотенца одноразовые | 2017-07-02 11:01:01 | 199.12 руб | 120 |          5 |         2 |           
(12 rows)
</pre></div>


<p>Подставим значения соответствующих product.product_id и затем удалим столбцы
manufacturer, product_name,&nbsp;price</p>
<div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">customers</span> <span class="k">SET</span> <span class="n">product_id</span> <span class="o">=</span> <span class="mf">1</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">in</span> <span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">,</span><span class="mf">7</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">customers</span> <span class="k">SET</span> <span class="n">product_id</span> <span class="o">=</span> <span class="mf">2</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">in</span> <span class="p">(</span><span class="mf">8</span><span class="p">,</span><span class="mf">9</span><span class="p">,</span><span class="mf">10</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">customers</span> <span class="k">SET</span> <span class="n">product_id</span><span class="o">=</span><span class="mf">3</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">in</span> <span class="p">(</span><span class="mf">11</span><span class="p">,</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">customers</span> <span class="k">SET</span> <span class="n">product_id</span><span class="o">=</span><span class="mf">4</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">in</span> <span class="p">(</span><span class="mf">14</span><span class="p">,</span><span class="mf">15</span><span class="p">,</span><span class="mf">16</span><span class="p">);</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">customers</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">manufacturer</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">customers</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">product_name</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">customers</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">price</span><span class="p">;</span>
</pre></div>


<p>Переименуем неудачно названный столбец salon_name, так как он означает суть 
salon_id, мы можем вычислить по нему salon_name, но в таблице мы указываем именно&nbsp;salon_id:</p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">customers</span> <span class="k">RENAME</span> <span class="k">COLUMN</span> <span class="n">salon_name</span> <span class="k">TO</span> <span class="n">salon_id</span><span class="p">;</span>
</pre></div>


<p>Можно переименовать&nbsp;ограничение </p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">customers</span> <span class="k">RENAME</span> <span class="k">CONSTRAINT</span> <span class="n">fk_salon_name</span> <span class="k">TO</span> <span class="n">fk_salon_id</span><span class="p">;</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# select * from customers ;
 id |      dateorder      | qty | salon_id | person_id | product_id 
----+---------------------+-----+----------+-----------+------------
  5 | 2017-07-03 12:15:01 |   3 |        1 |         1 |          1
  6 | 2017-07-03 12:15:01 |   3 |        2 |         1 |          1
  7 | 2017-07-03 12:15:01 |   3 |        4 |         1 |          1
  8 | 2017-07-03 12:16:01 |   2 |        1 |         1 |          2
  9 | 2017-07-03 12:16:01 |   2 |        2 |         1 |          2
 10 | 2017-07-03 12:16:01 |   2 |        4 |         1 |          2
 11 | 2017-07-02 11:01:01 |  12 |        3 |         2 |          3
 12 | 2017-07-02 11:01:01 |  12 |        4 |         2 |          3
 13 | 2017-07-02 11:01:01 |  12 |        5 |         2 |          3
 14 | 2017-07-02 11:01:01 | 120 |        3 |         2 |          4
 15 | 2017-07-02 11:01:01 | 120 |        4 |         2 |          4
 16 | 2017-07-02 11:01:01 | 120 |        5 |         2 |          4
(12 rows)
</pre></div>


<p>Также я хотел бы переименовать таблицу СUSTOMERS потому что она отражает скорее
заказы чем покупателей, переименуем в <span class="caps">ORDERS</span> (я изначально неправильно назвал 
исходную таблицу и вот в результате приведения проблема обозначилась очень явно,
когда убрали лишние по смыслу данные которые сбили меня с толку вначале):
<a href="http://www.postgresqltutorial.com/postgresql-rename-table/">link</a></p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">customers</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="n">orders</span><span class="p">;</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# \d orders 
                Table &quot;public.orders&quot;
   Column   |            Type             | Modifiers 
------------+-----------------------------+-----------
 id         | integer                     | not null
 dateorder  | timestamp without time zone | not null
 qty        | integer                     | not null
 salon_id   | integer                     | 
 person_id  | integer                     | 
 product_id | integer                     | 
Indexes:
    &quot;customers_pkey&quot; PRIMARY KEY, btree (id)
Foreign-key constraints:
    &quot;customers_product_id_fkey&quot; FOREIGN KEY (product_id) REFERENCES product(product_id)
    &quot;fk_person_id&quot; FOREIGN KEY (person_id) REFERENCES person(person_id)
    &quot;fk_salon_id&quot; FOREIGN KEY (salon_id) REFERENCES salon(salon_id)
</pre></div>


<p>Переименуем ограничения, так как после переименования у нас остались названия на 
более не существующее имя <span class="caps">CUSTOMERS</span>:</p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="k">RENAME</span> <span class="k">CONSTRAINT</span> <span class="n">customers_pkey</span> <span class="k">TO</span> <span class="n">orders_pkey</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="k">RENAME</span> <span class="k">CONSTRAINT</span> <span class="n">customers_product_id_fkey</span> <span class="k">TO</span> <span class="n">orders_product_id_fkey</span><span class="p">;</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# \d orders 
                Table &quot;public.orders&quot;
   Column   |            Type             | Modifiers 
------------+-----------------------------+-----------
 id         | integer                     | not null
 dateorder  | timestamp without time zone | not null
 qty        | integer                     | not null
 salon_id   | integer                     | 
 person_id  | integer                     | 
 product_id | integer                     | 
Indexes:
    &quot;orders_pkey&quot; PRIMARY KEY, btree (id)
Foreign-key constraints:
    &quot;fk_person_id&quot; FOREIGN KEY (person_id) REFERENCES person(person_id)
    &quot;fk_salon_id&quot; FOREIGN KEY (salon_id) REFERENCES salon(salon_id)
    &quot;orders_product_id_fkey&quot; FOREIGN KEY (product_id) REFERENCES product(product_id)
</pre></div>


<p>В результате преобразований получилась таблица <span class="caps">ORDER</span> которая все так же отражает
покупки покупателей, и мы по прежнему можем узнать детали относящиеся к покупателю,
цену отдельного товара и название&nbsp;производителя.</p>
<div class="highlight"><pre><span></span>haircolors=# select * from orders ;
 id |      dateorder      | qty | salon_id | person_id | product_id 
----+---------------------+-----+----------+-----------+------------
  5 | 2017-07-03 12:15:01 |   3 |        1 |         1 |          1
  6 | 2017-07-03 12:15:01 |   3 |        2 |         1 |          1
  7 | 2017-07-03 12:15:01 |   3 |        4 |         1 |          1
  8 | 2017-07-03 12:16:01 |   2 |        1 |         1 |          2
  9 | 2017-07-03 12:16:01 |   2 |        2 |         1 |          2
 10 | 2017-07-03 12:16:01 |   2 |        4 |         1 |          2
 11 | 2017-07-02 11:01:01 |  12 |        3 |         2 |          3
 12 | 2017-07-02 11:01:01 |  12 |        4 |         2 |          3
 13 | 2017-07-02 11:01:01 |  12 |        5 |         2 |          3
 14 | 2017-07-02 11:01:01 | 120 |        3 |         2 |          4
 15 | 2017-07-02 11:01:01 | 120 |        4 |         2 |          4
 16 | 2017-07-02 11:01:01 | 120 |        5 |         2 |          4
(12 rows)
</pre></div>


<p>Смотрим, у нас явно связь и повторы между person_id и salon_id, вынесем ее в таблицу 
которую назовем <span class="caps">PARTNER</span> и действительно, у нас покупатели являются партнерами-поставщиками
для&nbsp;салонов.</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">PARTNER</span> <span class="p">(</span>
  <span class="n">PARTNER_ID</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">,</span>
  <span class="n">PERSON_ID</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">PERSON</span><span class="p">(</span><span class="n">PERSON_ID</span><span class="p">),</span>
  <span class="n">SALON_ID</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">SALON</span><span class="p">(</span><span class="n">SALON_ID</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PARTNER</span> <span class="p">(</span><span class="n">PERSON_ID</span><span class="p">,</span> <span class="n">SALON_ID</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PARTNER</span> <span class="p">(</span><span class="n">PERSON_ID</span><span class="p">,</span> <span class="n">SALON_ID</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">2</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PARTNER</span> <span class="p">(</span><span class="n">PERSON_ID</span><span class="p">,</span> <span class="n">SALON_ID</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">4</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PARTNER</span> <span class="p">(</span><span class="n">PERSON_ID</span><span class="p">,</span> <span class="n">SALON_ID</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">2</span><span class="p">,</span> <span class="mf">3</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PARTNER</span> <span class="p">(</span><span class="n">PERSON_ID</span><span class="p">,</span> <span class="n">SALON_ID</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">2</span><span class="p">,</span> <span class="mf">4</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PARTNER</span> <span class="p">(</span><span class="n">PERSON_ID</span><span class="p">,</span> <span class="n">SALON_ID</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mf">2</span><span class="p">,</span> <span class="mf">5</span><span class="p">);</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# \d partner
                               Table &quot;public.partner&quot;
   Column   |  Type   |                          Modifiers                           
------------+---------+--------------------------------------------------------------
 partner_id | integer | not null default nextval(&#39;partner_partner_id_seq&#39;::regclass)
 person_id  | integer | 
 salon_id   | integer | 
Indexes:
    &quot;partner_pkey&quot; PRIMARY KEY, btree (partner_id)
Foreign-key constraints:
    &quot;partner_person_id_fkey&quot; FOREIGN KEY (person_id) REFERENCES person(person_id)
    &quot;partner_salon_id_fkey&quot; FOREIGN KEY (salon_id) REFERENCES salon(salon_id)
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# select * from partner;
 partner_id | person_id | salon_id 
------------+-----------+----------
          1 |         1 |        1
          2 |         1 |        2
          3 |         1 |        4
          4 |         2 |        3
          5 |         2 |        4
          6 |         2 |        5
(6 rows)
</pre></div>


<p>Получилось мы еще упростили нашу таблицу <span class="caps">ORDERS</span>, теперь возможно добавить 
партнера (как связь покупатель-салон, допустим это может означать, что салон начал
работать с новым поставщиком) и мы можем это сделать, даже если покупатель не совершил
ни одного заказа, чего раньше мы сделать просто не могли, так как для выражения
связи того что какой то покупатель поставляет гипотетически что то в какой то салон,
нам было необходимо чтоб этот покупатель совершил заказ.
Теперь у нас могут быть партнеры не совершившие ни одного заказа !
Вот одно из положительных качеств&nbsp;нормализации.</p>
<p>Также можно удалить столбцы salon_id, person_id из таблицы <span class="caps">ORDERS</span>.</p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">partner_id</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">partner</span><span class="p">(</span><span class="n">partner_id</span><span class="p">);</span>

<span class="k">UPDATE</span> <span class="n">orders</span> <span class="k">SET</span> <span class="n">partner_id</span> <span class="o">=</span> <span class="mf">1</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">8</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">orders</span> <span class="k">SET</span> <span class="n">partner_id</span> <span class="o">=</span> <span class="mf">2</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">6</span><span class="p">,</span><span class="mf">9</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">orders</span> <span class="k">SET</span> <span class="n">partner_id</span> <span class="o">=</span> <span class="mf">3</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">7</span><span class="p">,</span><span class="mf">10</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">orders</span> <span class="k">SET</span> <span class="n">partner_id</span> <span class="o">=</span> <span class="mf">4</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">11</span><span class="p">,</span><span class="mf">14</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">orders</span> <span class="k">SET</span> <span class="n">partner_id</span> <span class="o">=</span> <span class="mf">5</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">12</span><span class="p">,</span><span class="mf">15</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">orders</span> <span class="k">SET</span> <span class="n">partner_id</span> <span class="o">=</span> <span class="mf">6</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">13</span><span class="p">,</span><span class="mf">16</span><span class="p">);</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">salon_id</span> <span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">person_id</span> <span class="p">;</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# select * from orders order by id ;
 id |      dateorder      | qty | product_id | partner_id 
----+---------------------+-----+------------+------------
  5 | 2017-07-03 12:15:01 |   3 |          1 |          1
  6 | 2017-07-03 12:15:01 |   3 |          1 |          2
  7 | 2017-07-03 12:15:01 |   3 |          1 |          3
  8 | 2017-07-03 12:16:01 |   2 |          2 |          1
  9 | 2017-07-03 12:16:01 |   2 |          2 |          2
 10 | 2017-07-03 12:16:01 |   2 |          2 |          3
 11 | 2017-07-02 11:01:01 |  12 |          3 |          4
 12 | 2017-07-02 11:01:01 |  12 |          3 |          5
 13 | 2017-07-02 11:01:01 |  12 |          3 |          6
 14 | 2017-07-02 11:01:01 | 120 |          4 |          4
 15 | 2017-07-02 11:01:01 | 120 |          4 |          5
 16 | 2017-07-02 11:01:01 | 120 |          4 |          6
(12 rows)
</pre></div>


<p>Как видим тенденция такая, с каждым шагом появляется все больше таблиц, а изначальная 
таблица вырождается в описание связей. Управлять целостностью проще, данные разделяются
все больше по смыслу, но общую картину теперь возможно немного сложнее&nbsp;представить.</p>
<p>У нас присутствует дублирование на первый взгляд dateorder, qty, но это обусловлено
тем что мы изначально имели перечисление салонов в столбце <strong>salon_name</strong> и получается,
что покупатели как бы купили в одно и то же время разные товары сразу для нескольких
салонов, т.е. по смыслу здесь может быть и разное на самом деле время, то же 
самое относится к столбцу <strong>qty</strong>.</p>
<p>Но, и здесь можно убрать дублирование создадим таблицу&nbsp;ORDER_DETAILS</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">ORDER_DETAILS</span> <span class="p">(</span>
  <span class="n">ORDER_DETAILS_ID</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">DATEORDER</span> <span class="nb">TIMESTAMP</span><span class="p">,</span>
  <span class="n">QTY</span> <span class="nb">INT</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">ORDER_DETAILS</span> <span class="p">(</span><span class="n">DATEORDER</span><span class="p">,</span> <span class="n">QTY</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;2017-07-03 12:15:01&#39;</span><span class="p">,</span> <span class="mf">3</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">ORDER_DETAILS</span> <span class="p">(</span><span class="n">DATEORDER</span><span class="p">,</span> <span class="n">QTY</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;2017-07-03 12:16:01&#39;</span><span class="p">,</span> <span class="mf">2</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">ORDER_DETAILS</span> <span class="p">(</span><span class="n">DATEORDER</span><span class="p">,</span> <span class="n">QTY</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;2017-07-02 11:01:01&#39;</span><span class="p">,</span> <span class="mf">12</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">ORDER_DETAILS</span> <span class="p">(</span><span class="n">DATEORDER</span><span class="p">,</span> <span class="n">QTY</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;2017-07-02 11:01:01&#39;</span><span class="p">,</span> <span class="mf">120</span><span class="p">);</span>
</pre></div>


<div class="highlight"><pre><span></span>haircolors=# select * from order_details;
 order_details_id |      dateorder      | qty 
------------------+---------------------+-----
                1 | 2017-07-03 12:15:01 |   3
                2 | 2017-07-03 12:16:01 |   2
                3 | 2017-07-02 11:01:01 |  12
                4 | 2017-07-02 11:01:01 | 120
(4 rows)
</pre></div>


<p>Сошлемся на эти данные из таблицы <span class="caps">ORDERS</span>: </p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">ORDER_DETAILS_ID</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">order_details</span><span class="p">(</span><span class="n">order_details_id</span><span class="p">);</span>

<span class="k">UPDATE</span> <span class="n">orders</span> <span class="k">SET</span> <span class="n">order_details_id</span> <span class="o">=</span> <span class="mf">1</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">,</span><span class="mf">7</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">orders</span> <span class="k">SET</span> <span class="n">order_details_id</span><span class="o">=</span><span class="mf">2</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">8</span><span class="p">,</span><span class="mf">9</span><span class="p">,</span><span class="mf">10</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">orders</span> <span class="k">SET</span> <span class="n">order_details_id</span><span class="o">=</span><span class="mf">3</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">11</span><span class="p">,</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">);</span>
<span class="k">UPDATE</span> <span class="n">orders</span> <span class="k">SET</span> <span class="n">order_details_id</span><span class="o">=</span><span class="mf">4</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="mf">14</span><span class="p">,</span><span class="mf">15</span><span class="p">,</span><span class="mf">16</span><span class="p">);</span>
</pre></div>


<p>И теперь можно удалить столбцы dateorder,&nbsp;qty: </p>
<div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">dateorder</span> <span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">qty</span><span class="p">;</span>
</pre></div>


<p>Все, на этом можно остановиться, у нас данные находятся, во 2НФ, мы избавились от 
дубликатов в колонках, и теперь таблица <span class="caps">ORDERS</span> содержит уникальный первичный ключ <strong>id</strong>
отражающий номер покупки, а также включает в себя отображение связей кто (<strong>partner_id</strong>),
какой именно продукт (<strong>product_id</strong>) купил и когда (<strong>order_details_id</strong>).
Эти три значения отражают уникальность каждой покупки, в принципе можно даже 
отказаться от параметра id и использовать первичный сложный ключ из трех столбцов,
но по моему мнению это неудобно, я хочу иметь номер&nbsp;заказа.</p>
<div class="highlight"><pre><span></span>haircolors=# select * from orders;
 id | product_id | partner_id | order_details_id 
----+------------+------------+------------------
  5 |          1 |          1 |                1
  6 |          1 |          2 |                1
  7 |          1 |          3 |                1
  8 |          2 |          1 |                2
  9 |          2 |          2 |                2
 10 |          2 |          3 |                2
 11 |          3 |          4 |                3
 12 |          3 |          5 |                3
 13 |          3 |          6 |                3
 14 |          4 |          4 |                4
 15 |          4 |          5 |                4
 16 |          4 |          6 |                4
(12 rows)
</pre></div>


<p>В результате преобразований у нас получилось несколько таблиц, мы использовали 
связи различных типов, такие как <strong>ОДИН К ОДНОМУ</strong>, <strong>ОДИН КО МНОГИМ</strong>,
<strong>МНОГИЕ КО МНОГИМ</strong>.</p>
<p>Мое лично субьективное мнение, что формы в которой находится база данных сейчас
с практической точки зрения&nbsp;достаточно. </p>
<p>В следующей статье я возможно попробую привести некоторые данные в 3НФ, а также
нарисую схему связей нашей базы&nbsp;данных.</p>
<p><span class="caps">P.S.</span> Я буду очень рад если кто то, прочитав заметку, укажет на мои ошибки. Я честно 
старался принимать логичные решения и эволюционировал связи без всяческих &#8220;подгонок&#8221;.
Конечно же я мог ошибиться логически. Данная статья не является учебником для кого-то, и
написана мной для меня в первую&nbsp;очередь.</p>
<p>Для себя с некоторым удивлением замечаю как простая база в 4 записи превращается
во множество таблиц со связями. Советую людям которым интересно взять свой пример
и проделать похожее, как по мне это интересно и полезно&nbsp;;-)</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="https://kamyanskiy.github.io/2017/07/db-theory-high-forms.html">Процедура нормализации данных и нормальные формы данных (4НФ,&nbsp;5НФ).</a></li>
        <li><a href="https://kamyanskiy.github.io/2017/07/db-theory-3nf.html">Процедура нормализации данных и нормальные формы данных (НФБК,&nbsp;3НФ).</a></li>
        <li><a href="https://kamyanskiy.github.io/2017/07/db-theory-1nf.html">Процедура нормализации данных и нормальные формы данных&nbsp;(1НФ).</a></li>
    </ul>
</section>
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'kamyanskiy'; // required: replace example with your forum shortname

                    var disqus_identifier = 'db-theory-2nf';
                var disqus_url = 'https://kamyanskiy.github.io/2017/07/db-theory-2nf.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="https://kamyanskiy.github.io/images/profile.jpg"/>
        </p>
    <p>
      <strong>About Alexander Kamyanskiy</strong><br/>
        <span>I love Python and happy to use it everyday for develop Web applications, writing tests and others cool things.</span>
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="https://vk.com/id216671695"><i class="fa fa-vk fa-lg"></i> vk</a></li>
    <li class="list-group-item"><a href="https://www.facebook.com/alexander.kamyanskiy"><i class="fa fa-facebook-square fa-lg"></i> Facebook</a></li>
    <li class="list-group-item"><a href="https://github.com/kamyanskiy"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->

<!-- Sidebar/Recent Posts -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
  <ul class="list-group" id="recentposts">
    <li class="list-group-item"><a href="https://kamyanskiy.github.io/2017/07/db-theory-high-forms.html">Процедура нормализации данных и нормальные формы данных (4НФ,&nbsp;5НФ).</a></li>
    <li class="list-group-item"><a href="https://kamyanskiy.github.io/2017/07/db-theory-2nf.html">Процедура нормализации данных и нормальные формы данных&nbsp;(2НФ).</a></li>
    <li class="list-group-item"><a href="https://kamyanskiy.github.io/2017/07/db-theory-3nf.html">Процедура нормализации данных и нормальные формы данных (НФБК,&nbsp;3НФ).</a></li>
    <li class="list-group-item"><a href="https://kamyanskiy.github.io/2017/07/db-theory-1nf.html">Процедура нормализации данных и нормальные формы данных&nbsp;(1НФ).</a></li>
    <li class="list-group-item"><a href="https://kamyanskiy.github.io/2017/06/prepare-own-vagrant-box-from-existing.html">Create Vagrant base box manually from existing&nbsp;one</a></li>
  </ul>
</li>
<!-- End Sidebar/Recent Posts -->

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="https://kamyanskiy.github.io/label/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/1nf/">1NF</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/2nf/">2NF</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/3nf/">3NF</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://kamyanskiy.github.io/label/4nf/">4NF</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://kamyanskiy.github.io/label/5nf/">5NF</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/database/">database</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/db/">DB</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://kamyanskiy.github.io/label/disqus/">Disqus</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/jupyter/">jupyter</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/notebook/">notebook</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/packer/">packer</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/pelican/">Pelican</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/python/">Python</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/sql/">SQL</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/theory/">theory</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://kamyanskiy.github.io/label/vagrant/">vagrant</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://kamyanskiy.github.io/label/vagrant-vbguest/">vagrant-vbguest</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
</li>
<!-- End Sidebar/Github -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="http://getpelican.com/" target="_blank">Pelican</a>
    </li>
    <li class="list-group-item">
      <a href="http://python.org/" target="_blank">Python.org</a>
    </li>
    <li class="list-group-item">
      <a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a>
    </li>
    <li class="list-group-item">
      <a href="https://https://docs.djangoproject.com/" target="_blank">Django</a>
    </li>
    <li class="list-group-item">
      <a href="http://flask.pocoo.org/" target="_blank">Flask</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Alexander Kamyanskiy
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://kamyanskiy.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://kamyanskiy.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://kamyanskiy.github.io/theme/js/respond.min.js"></script>


<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = 'https://kamyanskiy.github.io/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'kamyanskiy',
    count: 5,
    skip_forks: false,
    target: '#gh_repos'
  });
});
</script>
<script src="https://kamyanskiy.github.io/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'kamyanskiy'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->


        <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-59403121442ae6be"></script>
</body>
</html>